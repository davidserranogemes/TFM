Leyendo  imdb
Executing  imdb with  Feedforward  arquitecture.

>>> Imports:
#coding=utf-8

try:
    from keras.datasets import mnist
except:
    pass

try:
    from keras.datasets import fashion_mnist
except:
    pass

try:
    from keras.datasets import cifar10
except:
    pass

try:
    from keras.datasets import imdb
except:
    pass

try:
    from keras import backend as K
except:
    pass

try:
    import numpy as np
except:
    pass

try:
    import sys
except:
    pass

try:
    import time
except:
    pass

try:
    import urllib.request
except:
    pass

try:
    import os
except:
    pass

try:
    from sklearn.model_selection import StratifiedKFold
except:
    pass

try:
    from hyperopt import Trials, STATUS_OK, tpe
except:
    pass

try:
    from keras.layers.core import Dense, Dropout, Activation, Flatten
except:
    pass

try:
    from keras.layers.convolutional import Convolution2D, MaxPooling2D
except:
    pass

try:
    from keras.optimizers import SGD, Adam
except:
    pass

try:
    from keras.models import Sequential
except:
    pass

try:
    from keras.utils import np_utils
except:
    pass

try:
    from hyperas import optim
except:
    pass

try:
    from hyperas.distributions import choice, uniform
except:
    pass

>>> Hyperas search space:

def get_space():
    return {
        'Dropout': hp.uniform('Dropout', 0, 0.5),
        'Dense': hp.choice('Dense', [256, 512, 1024]),
        'Activation': hp.choice('Activation', ['relu', 'sigmoid']),
        'Dropout_1': hp.uniform('Dropout_1', 0, 0.5),
        'Dropout_2': hp.choice('Dropout_2', ['three', 'four']),
        'add': hp.choice('add', [Dropout(0.5), Activation('linear')]),
        'optimizer': hp.choice('optimizer', ['rmsprop', 'adam', 'sgd']),
        'batch_size': hp.choice('batch_size', [64, 128]),
    }

>>> Data
  1: 
  2: num_words=10000
  3: skip_top= 20
  4: (x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=num_words,skip_top =skip_top)
  5: 
  6: X_train = np.zeros((len(x_train),num_words))
  7: X_test= np.zeros((len(x_test),num_words))
  8: 
  9: for i in range(1,len(x_train)):
 10: 	X_train[i,np.unique(x_train[i])[1:]] = True
 11: for i in range(1,len(x_train)):
 12: 	X_test[i,np.unique(x_test[i])[1:]] = True
 13: 
 14: nb_classes = len(np.unique(y_train))
 15: y_train = np_utils.to_categorical(y_train, nb_classes)
 16: y_test = np_utils.to_categorical(y_test, nb_classes)		
 17: 
 18: 
 19: 
 20: 
>>> Resulting replaced keras model:

   1: def keras_fmin_fnct(space):
   2: 
   3: 	num_epoch=1*200
   4: 	num_epoch=1*1
   5: 	nb_classes = y_train.shape[1]
   6: 
   7: 	model = Sequential()
   8: 	model.add(Dense(512, input_shape=X_train.shape[1:]))
   9: 	model.add(Activation('relu'))
  10: 	model.add(Dropout(space['Dropout']))
  11: 	model.add(Dense(space['Dense']))
  12: 	model.add(Activation(space['Activation']))
  13: 	model.add(Dropout(space['Dropout_1']))
  14: 
  15: 	# If we choose 'four', add an additional fourth layer
  16: 	if space['Dropout_2'] == 'four':
  17: 		model.add(Dense(100))
  18: 
  19: 		# We can also choose between complete sets of layers
  20: 
  21: 		model.add(space['add'])
  22: 		model.add(Activation('relu'))
  23: 
  24: 	model.add(Dense(nb_classes))
  25: 	model.add(Activation('softmax'))
  26: 
  27: 	model.compile(loss='categorical_crossentropy', metrics=['accuracy'],
  28: 	 					 optimizer=space['optimizer'])
  29: 
  30: 	result = model.fit(X_train, y_train,
  31: 				batch_size=space['batch_size'],
  32: 				epochs=num_epoch,
  33: 				verbose=2,
  34: 				validation_split=0.1)
  35: 	#get the highest validation accuracy of the training epochs
  36: 	validation_acc = np.amax(result.history['val_acc']) 
  37: 	print('Best validation acc of epoch:', validation_acc)
  38: 	return {'loss': -validation_acc, 'status': STATUS_OK, 'model': model}
  39: 
Downloading data from https://s3.amazonaws.com/text-datasets/imdb.npz

    8192/17464789 [..............................] - ETA: 5s
   24576/17464789 [..............................] - ETA: 1:25
   57344/17464789 [..............................] - ETA: 1:13
  122880/17464789 [..............................] - ETA: 51s 
  212992/17464789 [..............................] - ETA: 42s
  229376/17464789 [..............................] - ETA: 45s
  557056/17464789 [..............................] - ETA: 21s
  679936/17464789 [>.............................] - ETA: 18s
  737280/17464789 [>.............................] - ETA: 19s
  876544/17464789 [>.............................] - ETA: 16s
  909312/17464789 [>.............................] - ETA: 17s
 1064960/17464789 [>.............................] - ETA: 15s
 1097728/17464789 [>.............................] - ETA: 16s
 1277952/17464789 [=>............................] - ETA: 15s
 1466368/17464789 [=>............................] - ETA: 14s
 1654784/17464789 [=>............................] - ETA: 13s
 1744896/17464789 [=>............................] - ETA: 13s
 1867776/17464789 [==>...........................] - ETA: 13s
 2056192/17464789 [==>...........................] - ETA: 12s
 2129920/17464789 [==>...........................] - ETA: 12s
 2269184/17464789 [==>...........................] - ETA: 11s
 2334720/17464789 [===>..........................] - ETA: 11s
 2473984/17464789 [===>..........................] - ETA: 11s
 2531328/17464789 [===>..........................] - ETA: 11s
 2686976/17464789 [===>..........................] - ETA: 11s
 2736128/17464789 [===>..........................] - ETA: 11s
 2908160/17464789 [===>..........................] - ETA: 10s
 3031040/17464789 [====>.........................] - ETA: 10s
 3137536/17464789 [====>.........................] - ETA: 10s
 3293184/17464789 [====>.........................] - ETA: 10s
 3366912/17464789 [====>.........................] - ETA: 10s
 3506176/17464789 [=====>........................] - ETA: 9s 
 3571712/17464789 [=====>........................] - ETA: 9s
 3694592/17464789 [=====>........................] - ETA: 9s
 3801088/17464789 [=====>........................] - ETA: 9s
 3883008/17464789 [=====>........................] - ETA: 9s
 4038656/17464789 [=====>........................] - ETA: 9s
 4177920/17464789 [======>.......................] - ETA: 8s
 4268032/17464789 [======>.......................] - ETA: 8s
 4407296/17464789 [======>.......................] - ETA: 8s
 4497408/17464789 [======>.......................] - ETA: 8s
 4620288/17464789 [======>.......................] - ETA: 8s
 4718592/17464789 [=======>......................] - ETA: 8s
 4792320/17464789 [=======>......................] - ETA: 8s
 4964352/17464789 [=======>......................] - ETA: 8s
 5103616/17464789 [=======>......................] - ETA: 7s
 5210112/17464789 [=======>......................] - ETA: 7s
 5349376/17464789 [========>.....................] - ETA: 7s
 5431296/17464789 [========>.....................] - ETA: 7s
 5570560/17464789 [========>.....................] - ETA: 7s
 5677056/17464789 [========>.....................] - ETA: 7s
 5799936/17464789 [========>.....................] - ETA: 7s
 5922816/17464789 [=========>....................] - ETA: 7s
 6045696/17464789 [=========>....................] - ETA: 7s
 6152192/17464789 [=========>....................] - ETA: 7s
 6234112/17464789 [=========>....................] - ETA: 6s
 6389760/17464789 [=========>....................] - ETA: 6s
 6479872/17464789 [==========>...................] - ETA: 6s
 6635520/17464789 [==========>...................] - ETA: 6s
 6725632/17464789 [==========>...................] - ETA: 6s
 6881280/17464789 [==========>...................] - ETA: 6s
 6946816/17464789 [==========>...................] - ETA: 6s
 7127040/17464789 [===========>..................] - ETA: 6s
 7192576/17464789 [===========>..................] - ETA: 6s
 7364608/17464789 [===========>..................] - ETA: 6s
 7438336/17464789 [===========>..................] - ETA: 6s
 7610368/17464789 [============>.................] - ETA: 5s
 7684096/17464789 [============>.................] - ETA: 5s
 7856128/17464789 [============>.................] - ETA: 5s
 7905280/17464789 [============>.................] - ETA: 5s
 8085504/17464789 [============>.................] - ETA: 5s
 8134656/17464789 [============>.................] - ETA: 5s
 8273920/17464789 [=============>................] - ETA: 5s
 8380416/17464789 [=============>................] - ETA: 5s
 8519680/17464789 [=============>................] - ETA: 5s
 8617984/17464789 [=============>................] - ETA: 5s
 8757248/17464789 [==============>...............] - ETA: 5s
 8863744/17464789 [==============>...............] - ETA: 5s
 9003008/17464789 [==============>...............] - ETA: 4s
 9109504/17464789 [==============>...............] - ETA: 4s
 9248768/17464789 [==============>...............] - ETA: 4s
 9355264/17464789 [===============>..............] - ETA: 4s
 9494528/17464789 [===============>..............] - ETA: 4s
 9576448/17464789 [===============>..............] - ETA: 4s
 9682944/17464789 [===============>..............] - ETA: 4s
 9822208/17464789 [===============>..............] - ETA: 4s
 9904128/17464789 [================>.............] - ETA: 4s
10051584/17464789 [================>.............] - ETA: 4s
10117120/17464789 [================>.............] - ETA: 4s
10272768/17464789 [================>.............] - ETA: 4s
10346496/17464789 [================>.............] - ETA: 4s
10510336/17464789 [=================>............] - ETA: 3s
10584064/17464789 [=================>............] - ETA: 3s
10747904/17464789 [=================>............] - ETA: 3s
10829824/17464789 [=================>............] - ETA: 3s
10985472/17464789 [=================>............] - ETA: 3s
11075584/17464789 [==================>...........] - ETA: 3s
11231232/17464789 [==================>...........] - ETA: 3s
11321344/17464789 [==================>...........] - ETA: 3s
11476992/17464789 [==================>...........] - ETA: 3s
11558912/17464789 [==================>...........] - ETA: 3s
11698176/17464789 [===================>..........] - ETA: 3s
11804672/17464789 [===================>..........] - ETA: 3s
11943936/17464789 [===================>..........] - ETA: 3s
12050432/17464789 [===================>..........] - ETA: 3s
12206080/17464789 [===================>..........] - ETA: 2s
12296192/17464789 [====================>.........] - ETA: 2s
12451840/17464789 [====================>.........] - ETA: 2s
12533760/17464789 [====================>.........] - ETA: 2s
12673024/17464789 [====================>.........] - ETA: 2s
12779520/17464789 [====================>.........] - ETA: 2s
12918784/17464789 [=====================>........] - ETA: 2s
13025280/17464789 [=====================>........] - ETA: 2s
13148160/17464789 [=====================>........] - ETA: 2s
13271040/17464789 [=====================>........] - ETA: 2s
13393920/17464789 [======================>.......] - ETA: 2s
13508608/17464789 [======================>.......] - ETA: 2s
13598720/17464789 [======================>.......] - ETA: 2s
13737984/17464789 [======================>.......] - ETA: 2s
13811712/17464789 [======================>.......] - ETA: 2s
13967360/17464789 [======================>.......] - ETA: 1s
14032896/17464789 [=======================>......] - ETA: 1s
14204928/17464789 [=======================>......] - ETA: 1s
14278656/17464789 [=======================>......] - ETA: 1s
14417920/17464789 [=======================>......] - ETA: 1s
14508032/17464789 [=======================>......] - ETA: 1s
14606336/17464789 [========================>.....] - ETA: 1s
14761984/17464789 [========================>.....] - ETA: 1s
14868480/17464789 [========================>.....] - ETA: 1s
15007744/17464789 [========================>.....] - ETA: 1s
15114240/17464789 [========================>.....] - ETA: 1s
15269888/17464789 [=========================>....] - ETA: 1s
15392768/17464789 [=========================>....] - ETA: 1s
15515648/17464789 [=========================>....] - ETA: 1s
15622144/17464789 [=========================>....] - ETA: 0s
15777792/17464789 [==========================>...] - ETA: 0s
15876096/17464789 [==========================>...] - ETA: 0s
16039936/17464789 [==========================>...] - ETA: 0s
16154624/17464789 [==========================>...] - ETA: 0s
16293888/17464789 [==========================>...] - ETA: 0s
16416768/17464789 [===========================>..] - ETA: 0s
16556032/17464789 [===========================>..] - ETA: 0s
16678912/17464789 [===========================>..] - ETA: 0s
16801792/17464789 [===========================>..] - ETA: 0s
16941056/17464789 [============================>.] - ETA: 0s
17080320/17464789 [============================>.] - ETA: 0s
17203200/17464789 [============================>.] - ETA: 0s
17342464/17464789 [============================>.] - ETA: 0s
17465344/17464789 [==============================] - 9s 1us/step
Unexpected error: <class 'ValueError'>
