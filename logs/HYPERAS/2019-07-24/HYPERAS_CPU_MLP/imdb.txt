Leyendo  imdb
Executing  imdb with  Feedforward  arquitecture.

>>> Imports:
#coding=utf-8

try:
    from keras.datasets import mnist
except:
    pass

try:
    from keras.datasets import fashion_mnist
except:
    pass

try:
    from keras.datasets import cifar10
except:
    pass

try:
    from keras.datasets import imdb
except:
    pass

try:
    from keras import backend as K
except:
    pass

try:
    import numpy as np
except:
    pass

try:
    import sys
except:
    pass

try:
    import time
except:
    pass

try:
    import urllib.request
except:
    pass

try:
    import os
except:
    pass

try:
    from sklearn.model_selection import StratifiedKFold
except:
    pass

try:
    from hyperopt import Trials, STATUS_OK, tpe
except:
    pass

try:
    from keras.layers.core import Dense, Dropout, Activation, Flatten
except:
    pass

try:
    from keras.layers.convolutional import Convolution2D, MaxPooling2D
except:
    pass

try:
    from keras.optimizers import SGD, Adam
except:
    pass

try:
    from keras.models import Sequential
except:
    pass

try:
    from keras.utils import np_utils
except:
    pass

try:
    from hyperas import optim
except:
    pass

try:
    from hyperas.distributions import choice, uniform
except:
    pass

>>> Hyperas search space:

def get_space():
    return {
        'Dropout': hp.uniform('Dropout', 0, 0.5),
        'Dense': hp.choice('Dense', [256, 512, 1024]),
        'Activation': hp.choice('Activation', ['relu', 'sigmoid']),
        'Dropout_1': hp.uniform('Dropout_1', 0, 0.5),
        'Dropout_2': hp.choice('Dropout_2', ['three', 'four']),
        'add': hp.choice('add', [Dropout(0.5), Activation('linear')]),
        'optimizer': hp.choice('optimizer', ['rmsprop', 'adam', 'sgd']),
        'batch_size': hp.choice('batch_size', [64, 128]),
    }

>>> Data
  1: 
  2: num_words=10000
  3: skip_top= 20
  4: (x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=num_words,skip_top =skip_top)
  5: 
  6: X_train = np.zeros((len(x_train),num_words))
  7: X_test= np.zeros((len(x_test),num_words))
  8: 
  9: for i in range(1,len(x_train)):
 10: 	X_train[i,np.unique(x_train[i])[1:]] = True
 11: for i in range(1,len(x_train)):
 12: 	X_test[i,np.unique(x_test[i])[1:]] = True
 13: 
 14: nb_classes = len(np.unique(y_train))
 15: y_train = np_utils.to_categorical(y_train, nb_classes)
 16: y_test = np_utils.to_categorical(y_test, nb_classes)		
 17: 
 18: 
 19: 
 20: 
>>> Resulting replaced keras model:

   1: def keras_fmin_fnct(space):
   2: 
   3: 	num_epoch=1*200
   4: 	num_epoch=1*1
   5: 	nb_classes = y_train.shape[1]
   6: 
   7: 	model = Sequential()
   8: 	model.add(Dense(512, input_shape=X_train.shape[1:]))
   9: 	model.add(Activation('relu'))
  10: 	model.add(Dropout(space['Dropout']))
  11: 	model.add(Dense(space['Dense']))
  12: 	model.add(Activation(space['Activation']))
  13: 	model.add(Dropout(space['Dropout_1']))
  14: 
  15: 	# If we choose 'four', add an additional fourth layer
  16: 	if space['Dropout_2'] == 'four':
  17: 		model.add(Dense(100))
  18: 
  19: 		# We can also choose between complete sets of layers
  20: 
  21: 		model.add(space['add'])
  22: 		model.add(Activation('relu'))
  23: 
  24: 	model.add(Dense(nb_classes))
  25: 	model.add(Activation('softmax'))
  26: 
  27: 	model.compile(loss='categorical_crossentropy', metrics=['accuracy'],
  28: 	 					 optimizer=space['optimizer'])
  29: 
  30: 	result = model.fit(X_train, y_train,
  31: 				batch_size=space['batch_size'],
  32: 				epochs=num_epoch,
  33: 				verbose=2,
  34: 				validation_split=0.1)
  35: 	#get the highest validation accuracy of the training epochs
  36: 	validation_acc = np.amax(result.history['val_acc']) 
  37: 	print('Best validation acc of epoch:', validation_acc)
  38: 	return {'loss': -validation_acc, 'status': STATUS_OK, 'model': model}
  39: 
Downloading data from https://s3.amazonaws.com/text-datasets/imdb.npz

    8192/17464789 [..............................] - ETA: 7:14
   40960/17464789 [..............................] - ETA: 2:54
  106496/17464789 [..............................] - ETA: 1:39
  212992/17464789 [..............................] - ETA: 1:06
  319488/17464789 [..............................] - ETA: 51s 
  417792/17464789 [..............................] - ETA: 44s
  524288/17464789 [..............................] - ETA: 39s
  647168/17464789 [>.............................] - ETA: 35s
  770048/17464789 [>.............................] - ETA: 33s
  843776/17464789 [>.............................] - ETA: 31s
  892928/17464789 [>.............................] - ETA: 31s
  925696/17464789 [>.............................] - ETA: 30s
 1015808/17464789 [>.............................] - ETA: 31s
 1171456/17464789 [=>............................] - ETA: 27s
 1236992/17464789 [=>............................] - ETA: 27s
 1253376/17464789 [=>............................] - ETA: 27s
 1343488/17464789 [=>............................] - ETA: 26s
 1376256/17464789 [=>............................] - ETA: 26s
 1449984/17464789 [=>............................] - ETA: 25s
 1482752/17464789 [=>............................] - ETA: 25s
 1556480/17464789 [=>............................] - ETA: 25s
 1589248/17464789 [=>............................] - ETA: 25s
 1654784/17464789 [=>............................] - ETA: 24s
 1695744/17464789 [=>............................] - ETA: 24s
 1777664/17464789 [==>...........................] - ETA: 24s
 1835008/17464789 [==>...........................] - ETA: 23s
 1900544/17464789 [==>...........................] - ETA: 24s
 2023424/17464789 [==>...........................] - ETA: 24s
 2129920/17464789 [==>...........................] - ETA: 25s
 2318336/17464789 [==>...........................] - ETA: 24s
 2408448/17464789 [===>..........................] - ETA: 24s
 2490368/17464789 [===>..........................] - ETA: 23s
 2596864/17464789 [===>..........................] - ETA: 24s
 2686976/17464789 [===>..........................] - ETA: 23s
 2785280/17464789 [===>..........................] - ETA: 23s
 2875392/17464789 [===>..........................] - ETA: 23s
 2981888/17464789 [====>.........................] - ETA: 23s
 3088384/17464789 [====>.........................] - ETA: 22s
 3186688/17464789 [====>.........................] - ETA: 22s
 3276800/17464789 [====>.........................] - ETA: 21s
 3293184/17464789 [====>.........................] - ETA: 22s
 3399680/17464789 [====>.........................] - ETA: 21s
 3506176/17464789 [=====>........................] - ETA: 21s
 3604480/17464789 [=====>........................] - ETA: 21s
 3710976/17464789 [=====>........................] - ETA: 21s
 3817472/17464789 [=====>........................] - ETA: 20s
 3923968/17464789 [=====>........................] - ETA: 20s
 4022272/17464789 [=====>........................] - ETA: 20s
 4128768/17464789 [======>.......................] - ETA: 20s
 4235264/17464789 [======>.......................] - ETA: 19s
 4341760/17464789 [======>.......................] - ETA: 19s
 4440064/17464789 [======>.......................] - ETA: 19s
 4546560/17464789 [======>.......................] - ETA: 19s
 4653056/17464789 [======>.......................] - ETA: 19s
 4775936/17464789 [=======>......................] - ETA: 19s
 4874240/17464789 [=======>......................] - ETA: 19s
 4980736/17464789 [=======>......................] - ETA: 19s
 5087232/17464789 [=======>......................] - ETA: 19s
 5193728/17464789 [=======>......................] - ETA: 19s
 5292032/17464789 [========>.....................] - ETA: 19s
 5398528/17464789 [========>.....................] - ETA: 18s
 5505024/17464789 [========>.....................] - ETA: 18s
 5627904/17464789 [========>.....................] - ETA: 18s
 5734400/17464789 [========>.....................] - ETA: 18s
 5832704/17464789 [=========>....................] - ETA: 18s
 5955584/17464789 [=========>....................] - ETA: 18s
 6078464/17464789 [=========>....................] - ETA: 18s
 6184960/17464789 [=========>....................] - ETA: 17s
 6307840/17464789 [=========>....................] - ETA: 17s
 6430720/17464789 [==========>...................] - ETA: 17s
 6545408/17464789 [==========>...................] - ETA: 17s
 6684672/17464789 [==========>...................] - ETA: 17s
 6807552/17464789 [==========>...................] - ETA: 16s
 6963200/17464789 [==========>...................] - ETA: 16s
 7086080/17464789 [===========>..................] - ETA: 16s
 7282688/17464789 [===========>..................] - ETA: 15s
 7348224/17464789 [===========>..................] - ETA: 15s
 7380992/17464789 [===========>..................] - ETA: 15s
 7454720/17464789 [===========>..................] - ETA: 15s
 7503872/17464789 [===========>..................] - ETA: 15s
 7577600/17464789 [============>.................] - ETA: 15s
 7610368/17464789 [============>.................] - ETA: 15s
 7700480/17464789 [============>.................] - ETA: 14s
 7733248/17464789 [============>.................] - ETA: 14s
 7823360/17464789 [============>.................] - ETA: 14s
 7856128/17464789 [============>.................] - ETA: 14s
 7938048/17464789 [============>.................] - ETA: 14s
 7979008/17464789 [============>.................] - ETA: 14s
 8060928/17464789 [============>.................] - ETA: 14s
 8101888/17464789 [============>.................] - ETA: 14s
 8200192/17464789 [=============>................] - ETA: 13s
 8241152/17464789 [=============>................] - ETA: 13s
 8323072/17464789 [=============>................] - ETA: 13s
 8372224/17464789 [=============>................] - ETA: 13s
 8462336/17464789 [=============>................] - ETA: 13s
 8495104/17464789 [=============>................] - ETA: 13s
 8601600/17464789 [=============>................] - ETA: 13s
 8634368/17464789 [=============>................] - ETA: 13s
 8716288/17464789 [=============>................] - ETA: 12s
 8773632/17464789 [==============>...............] - ETA: 12s
 8847360/17464789 [==============>...............] - ETA: 12s
 8912896/17464789 [==============>...............] - ETA: 12s
 8994816/17464789 [==============>...............] - ETA: 12s
 9052160/17464789 [==============>...............] - ETA: 12s
 9158656/17464789 [==============>...............] - ETA: 12s
 9191424/17464789 [==============>...............] - ETA: 12s
 9281536/17464789 [==============>...............] - ETA: 11s
 9355264/17464789 [===============>..............] - ETA: 11s
 9453568/17464789 [===============>..............] - ETA: 11s
 9494528/17464789 [===============>..............] - ETA: 11s
 9592832/17464789 [===============>..............] - ETA: 11s
 9650176/17464789 [===============>..............] - ETA: 11s
 9732096/17464789 [===============>..............] - ETA: 11s
 9789440/17464789 [===============>..............] - ETA: 10s
 9887744/17464789 [===============>..............] - ETA: 10s
 9945088/17464789 [================>.............] - ETA: 10s
10051584/17464789 [================>.............] - ETA: 10s
10084352/17464789 [================>.............] - ETA: 10s
10190848/17464789 [================>.............] - ETA: 10s
10240000/17464789 [================>.............] - ETA: 10s
10305536/17464789 [================>.............] - ETA: 10s
10379264/17464789 [================>.............] - ETA: 9s 
10469376/17464789 [================>.............] - ETA: 9s
10534912/17464789 [=================>............] - ETA: 9s
10625024/17464789 [=================>............] - ETA: 9s
10690560/17464789 [=================>............] - ETA: 9s
10764288/17464789 [=================>............] - ETA: 9s
10829824/17464789 [=================>............] - ETA: 9s
10936320/17464789 [=================>............] - ETA: 8s
10985472/17464789 [=================>............] - ETA: 8s
11075584/17464789 [==================>...........] - ETA: 8s
11124736/17464789 [==================>...........] - ETA: 8s
11214848/17464789 [==================>...........] - ETA: 8s
11280384/17464789 [==================>...........] - ETA: 8s
11370496/17464789 [==================>...........] - ETA: 8s
11444224/17464789 [==================>...........] - ETA: 8s
11509760/17464789 [==================>...........] - ETA: 8s
11583488/17464789 [==================>...........] - ETA: 7s
11665408/17464789 [===================>..........] - ETA: 7s
11739136/17464789 [===================>..........] - ETA: 7s
11804672/17464789 [===================>..........] - ETA: 7s
11878400/17464789 [===================>..........] - ETA: 7s
11976704/17464789 [===================>..........] - ETA: 7s
12034048/17464789 [===================>..........] - ETA: 7s
12115968/17464789 [===================>..........] - ETA: 7s
12189696/17464789 [===================>..........] - ETA: 6s
12255232/17464789 [====================>.........] - ETA: 6s
12328960/17464789 [====================>.........] - ETA: 6s
12419072/17464789 [====================>.........] - ETA: 6s
12484608/17464789 [====================>.........] - ETA: 6s
12558336/17464789 [====================>.........] - ETA: 6s
12623872/17464789 [====================>.........] - ETA: 6s
12713984/17464789 [====================>.........] - ETA: 6s
12779520/17464789 [====================>.........] - ETA: 6s
12869632/17464789 [=====================>........] - ETA: 5s
12935168/17464789 [=====================>........] - ETA: 5s
13008896/17464789 [=====================>........] - ETA: 5s
13074432/17464789 [=====================>........] - ETA: 5s
13164544/17464789 [=====================>........] - ETA: 5s
13230080/17464789 [=====================>........] - ETA: 5s
13320192/17464789 [=====================>........] - ETA: 5s
13393920/17464789 [======================>.......] - ETA: 5s
13459456/17464789 [======================>.......] - ETA: 5s
13533184/17464789 [======================>.......] - ETA: 5s
13615104/17464789 [======================>.......] - ETA: 4s
13688832/17464789 [======================>.......] - ETA: 4s
13770752/17464789 [======================>.......] - ETA: 4s
13844480/17464789 [======================>.......] - ETA: 4s
13926400/17464789 [======================>.......] - ETA: 4s
14000128/17464789 [=======================>......] - ETA: 4s
14090240/17464789 [=======================>......] - ETA: 4s
14155776/17464789 [=======================>......] - ETA: 4s
14245888/17464789 [=======================>......] - ETA: 4s
14311424/17464789 [=======================>......] - ETA: 3s
14401536/17464789 [=======================>......] - ETA: 3s
14467072/17464789 [=======================>......] - ETA: 3s
14557184/17464789 [========================>.....] - ETA: 3s
14622720/17464789 [========================>.....] - ETA: 3s
14712832/17464789 [========================>.....] - ETA: 3s
14786560/17464789 [========================>.....] - ETA: 3s
14901248/17464789 [========================>.....] - ETA: 3s
14958592/17464789 [========================>.....] - ETA: 3s
15065088/17464789 [========================>.....] - ETA: 2s
15114240/17464789 [========================>.....] - ETA: 2s
15220736/17464789 [=========================>....] - ETA: 2s
15286272/17464789 [=========================>....] - ETA: 2s
15376384/17464789 [=========================>....] - ETA: 2s
15441920/17464789 [=========================>....] - ETA: 2s
15548416/17464789 [=========================>....] - ETA: 2s
15622144/17464789 [=========================>....] - ETA: 2s
15720448/17464789 [==========================>...] - ETA: 2s
15794176/17464789 [==========================>...] - ETA: 2s
15900672/17464789 [==========================>...] - ETA: 1s
15966208/17464789 [==========================>...] - ETA: 1s
16089088/17464789 [==========================>...] - ETA: 1s
16154624/17464789 [==========================>...] - ETA: 1s
16261120/17464789 [==========================>...] - ETA: 1s
16334848/17464789 [===========================>..] - ETA: 1s
16457728/17464789 [===========================>..] - ETA: 1s
16523264/17464789 [===========================>..] - ETA: 1s
16646144/17464789 [===========================>..] - ETA: 0s
16711680/17464789 [===========================>..] - ETA: 0s
16834560/17464789 [===========================>..] - ETA: 0s
16908288/17464789 [============================>.] - ETA: 0s
17047552/17464789 [============================>.] - ETA: 0s
17113088/17464789 [============================>.] - ETA: 0s
17235968/17464789 [============================>.] - ETA: 0s
17309696/17464789 [============================>.] - ETA: 0s
17448960/17464789 [============================>.] - ETA: 0s
17465344/17464789 [==============================] - 20s 1us/step
Unexpected error: <class 'ValueError'>
